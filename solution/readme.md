### Build Status

[![Build Status](https://dev.azure.com/bhatnitesh/TechChallengeApp/_apis/build/status/niteshbhat.TechChallengeApp?branchName=master)](https://dev.azure.com/bhatnitesh/TechChallengeApp/_build/latest?definitionId=4&branchName=master)


### Pre-Request
1. **Registry/Repository: Docker HUB**

* We need to make sure that we have a registry service running in our environment, I am using Docker HUB as a registry/repository where I can upload the container images generated by dockerfile.
  For example we are using a Public registry by name for this task: **evila/tech-challenge** (https://hub.docker.com/repository/docker/evila/tech-challenge)

 2. **CI/CD: Azure Pipeline**
 
 * we have to create or in the current org we have to create a new project here I have created a project
   with the name: TechChallengeApp (https://dev.azure.com/bhatnitesh/TechChallengeApp).
 * In the Project setting, we need to configure some service Connections which we are using in the project
   
   * **Github** ( Secure connection with Github Repo:https://github.com/niteshbhat/TechChallengeApp)
   * **Docker Registry** ( created secure connection to my registry https://hub.docker.com/repository/docker/evila)
   * **ARM** ( here ARM name we are using is Azure subscription for secure connection"
   * **Azure Classic**
 
 After that, we have to make sure each above service connections have permission to use in pipeline example: **niteshbhat.TechChallengeApp**.
 
 * Configure a pipeline by selecting "Existing Azure Pipelines" and link the repo https://github.com/niteshbhat/TechChallengeApp/solution/Build/build.yml)
 * We need to install some of new extensions from Azure Marketplace in the Azure DevOps pipeline which we are going to use in the pipeline
   **Terraform**
    1)Terraform VSTS build task
    2)Terraform (Microsoft Dev Lab)
    3)Terraform Import
 * Make sure the Parallel job should be enabled to run the agent job

### Description
Here we are using Azure devOps Pipeline we are tring to use dockerfile to build the container image and upload the it in docker hub and in same pipeline we have added 
code to run terraform code which will take care to build the application in running in container.


<details><summary>Enviroment Variable</summary>
<p>

#### Terraform { var.PASSWORD }

```
variable "PASSWORD" {
  description = "Database administrator password"
  type        = string
  sensitive   = true
}

variable "rg_name" {
  description = "variable contain the name of resource group"
  type    = string
  default = "az-servian-rg"
}

variable "tags" {
  description = "Tag to decided the env of infra"
  type = map
  default = {
    "env" = "dev"
  }
}

variable "location" {
  description = "Infra Application Location"
  type    = string
  default = "West US"
}


variable "servian-aci" {
  
  type = map
  default = {
    "name"             = "servian-techchallenge"
    "dns_label"        = "servian-techchallenge"
    "container1_name"  = "postgres"
    "container1_image" = "postgres:latest"
    "container2_name"  = "tech-challenge"
    "container2_image" = "evila/tech-challenge:latest"
    "DbHost"           = "localhost"
    "ListenHost"       = "0.0.0.0"
    "ListenPort"       = "80"
  }
}

```
 
</p>
</details>
<details><summary>Terraform resource used</summary>
<p>

#### azurerm_resource_group

```
  resource "azurerm_resource_group" "az-rg" {
  name     = var.rg_name
  location = var.location
}
```
#### azurerm_container_group

```
  resource "azurerm_container_group" "servian-az-aci" {
  name                = var.servian-aci["name"]
  location            = azurerm_resource_group.az-rg.location
  resource_group_name = azurerm_resource_group.az-rg.name
  ip_address_type     = "Public"
  dns_name_label      = var.servian-aci["dns_label"]
  os_type             = "Linux"
 
  container {
    name   = var.servian-aci["container1_name"]
    image  = var.servian-aci["container1_image"]
    cpu    = "1.0"
    memory = "1.5"
    secure_environment_variables = {
      "VTT_DBHOST"        = var.servian-aci["DbHost"]
      "POSTGRES_PASSWORD" = "changeme"
      "VTT_LISTENHOST"    = var.servian-aci["ListenHost"]
    }

  }

  container {
    name     = var.servian-aci["container2_name"]
    image    = var.servian-aci["container2_image"]
    cpu      = "1.0"
    memory   = "1.5"
    commands = ["/bin/sh", "-c", "sleep 10 ;  ./TechChallengeApp updatedb; ./TechChallengeApp serve"]
    secure_environment_variables = {
      "VTT_DBHOST"     = var.servian-aci["DbHost"]
      "VTT_DBPASSWORD" = "changeme"
      "VTT_LISTENPORT" = var.servian-aci["ListenPort"]
      "VTT_LISTENHOST" = var.servian-aci["ListenHost"]
    }
    ports {
      port = 80
    }
  
  }
}
}
```  
</p>
</details>
**Issues and Pull requests should only be made for changes to the application code, not Tech Challenge Assessments.**

Please explain the changes you made here.

Fixes: [https://github.com/servian/TechChallengeApp/issues/{issue](https://github.com/servian/TechChallengeApp/issues/%7Bissue) number}
